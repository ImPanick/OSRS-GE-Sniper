<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GE Sniper Config - {{ guild_id }}</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <h1>‚öôÔ∏è Server Configuration</h1>
  
  <nav>
    <a href="/dashboard">üìä Dashboard</a>
    <a href="/volume_tracker">üìà Volume Tracker</a>
    <a href="/admin">üîí Admin</a>
  </nav>

  <div style="max-width: 1200px; margin: 0 auto; padding: 0 2rem;">
    <div class="card" style="margin-bottom: 1rem;">
      <h3 style="margin: 0;">Guild ID: <code style="color: var(--accent-primary); background: var(--bg-tertiary); padding: 0.25rem 0.5rem; border-radius: var(--radius-sm);">{{ guild_id }}</code></h3>
    </div>

    <div class="card">
      <h2>üì¢ Channel Routing</h2>
      <p style="color: var(--text-secondary); margin-bottom: 2rem;">Configure which Discord channels receive different types of notifications.</p>
      
      <div class="channel-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
        <div class="filter-group">
          <label>Cheap Flips (&lt; {{ (config.thresholds.cheap_max / 1000)|int }}k)</label>
          <input type="text" id="cheap_flips" placeholder="#cheap-flips" value="{{ config.channels.cheap_flips or '' }}">
        </div>
        <div class="filter-group">
          <label>Medium Flips ({{ (config.thresholds.cheap_max / 1000)|int }}k - {{ (config.thresholds.medium_max / 1000)|int }}k)</label>
          <input type="text" id="medium_flips" placeholder="#medium-flips" value="{{ config.channels.medium_flips or '' }}">
        </div>
        <div class="filter-group">
          <label>Expensive Flips ({{ (config.thresholds.medium_max / 1000)|int }}k - {{ (config.thresholds.expensive_max / 1000000)|int }}M)</label>
          <input type="text" id="expensive_flips" placeholder="#expensive-flips" value="{{ config.channels.expensive_flips or '' }}">
        </div>
        <div class="filter-group">
          <label>Billionaire Flips (&gt; {{ (config.thresholds.expensive_max / 1000000)|int }}M)</label>
          <input type="text" id="billionaire_flips" placeholder="#billionaire-flips" value="{{ config.channels.billionaire_flips or '' }}">
        </div>
        <div class="filter-group">
          <label>Recipe Items (Herbs, Secondaries, etc)</label>
          <input type="text" id="recipe_items" placeholder="#recipe-items" value="{{ config.channels.recipe_items or '' }}">
        </div>
        <div class="filter-group">
          <label>High-Alch Margins</label>
          <input type="text" id="high_alch_margins" placeholder="#high-alch" value="{{ config.channels.high_alch_margins or '' }}">
        </div>
        <div class="filter-group">
          <label>High Limit + Volume Items</label>
          <input type="text" id="high_limit_items" placeholder="#high-limit" value="{{ config.channels.high_limit_items or '' }}">
        </div>
      </div>
      
      <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
        <button onclick="save()" style="min-width: 200px;">üíæ Save Configuration</button>
        <button onclick="location.reload()" class="secondary" style="min-width: 200px;">üîÑ Reset</button>
      </div>
      
      <div id="save_status" style="margin-top: 1.5rem; min-height: 1.5rem; text-align: center;"></div>
    </div>

    <div class="card">
      <h2>üîî Role Ping Configuration</h2>
      <p style="color: var(--text-secondary); margin-bottom: 2rem;">
        Configure roles to ping based on risk level and quality. Enter role IDs or role names (without @).
      </p>
      <div class="channel-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
        <div class="filter-group">
          <label>Low Risk Dumps (&lt; 20 risk score)</label>
          <input type="text" id="risk_low" placeholder="Role ID or name" value="{{ config.roles.risk_low or '' }}">
        </div>
        <div class="filter-group">
          <label>Medium Risk Dumps (20-40 risk score)</label>
          <input type="text" id="risk_medium" placeholder="Role ID or name" value="{{ config.roles.risk_medium or '' }}">
        </div>
        <div class="filter-group">
          <label>High Risk Dumps (40-60 risk score)</label>
          <input type="text" id="risk_high" placeholder="Role ID or name" value="{{ config.roles.risk_high or '' }}">
        </div>
        <div class="filter-group">
          <label>Very High Risk Dumps (60+ risk score)</label>
          <input type="text" id="risk_very_high" placeholder="Role ID or name" value="{{ config.roles.risk_very_high or '' }}">
        </div>
        <div class="filter-group">
          <label>Nuclear Dumps (1.5M+ volume)</label>
          <input type="text" id="quality_nuclear" placeholder="Role ID or name" value="{{ config.roles.quality_nuclear or '' }}">
        </div>
        <div class="filter-group">
          <label>God-Tier Dumps (‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê)</label>
          <input type="text" id="quality_god_tier" placeholder="Role ID or name" value="{{ config.roles.quality_god_tier or '' }}">
        </div>
        <div class="filter-group">
          <label>Elite Dumps (‚≠ê‚≠ê‚≠ê‚≠ê)</label>
          <input type="text" id="quality_elite" placeholder="Role ID or name" value="{{ config.roles.quality_elite or '' }}">
        </div>
        <div class="filter-group">
          <label>Premium Dumps (‚≠ê‚≠ê‚≠ê)</label>
          <input type="text" id="quality_premium" placeholder="Role ID or name" value="{{ config.roles.quality_premium or '' }}">
        </div>
        <div class="filter-group">
          <label>Good Dumps (‚≠ê‚≠ê)</label>
          <input type="text" id="quality_good" placeholder="Role ID or name" value="{{ config.roles.quality_good or '' }}">
        </div>
        <div class="filter-group">
          <label>Deal Dumps (‚≠ê)</label>
          <input type="text" id="quality_deal" placeholder="Role ID or name" value="{{ config.roles.quality_deal or '' }}">
        </div>
        <div class="filter-group">
          <label>All Dumps (General)</label>
          <input type="text" id="dumps" placeholder="Role ID or name" value="{{ config.roles.dumps or '' }}">
        </div>
        <div class="filter-group">
          <label>All Spikes (General)</label>
          <input type="text" id="spikes" placeholder="Role ID or name" value="{{ config.roles.spikes or '' }}">
        </div>
        <div class="filter-group">
          <label>All Flips (General)</label>
          <input type="text" id="flips" placeholder="Role ID or name" value="{{ config.roles.flips or '' }}">
        </div>
      </div>
    </div>
  </div>

  <footer>
    <p>Configuration Panel ‚Ä¢ Changes take effect immediately</p>
  </footer>

  <script>
    function save() {
      const statusDiv = document.getElementById('save_status');
      statusDiv.innerHTML = '<div class="loading" style="margin: 0 auto;"></div><p style="margin-top: 0.5rem; color: var(--text-muted);">Saving...</p>';
      
      const config = {
        channels: {
          cheap_flips: document.getElementById('cheap_flips').value.trim() || null,
          medium_flips: document.getElementById('medium_flips').value.trim() || null,
          expensive_flips: document.getElementById('expensive_flips').value.trim() || null,
          billionaire_flips: document.getElementById('billionaire_flips').value.trim() || null,
          recipe_items: document.getElementById('recipe_items').value.trim() || null,
          high_alch_margins: document.getElementById('high_alch_margins').value.trim() || null,
          high_limit_items: document.getElementById('high_limit_items').value.trim() || null
        },
        roles: {
          risk_low: document.getElementById('risk_low')?.value.trim() || null,
          risk_medium: document.getElementById('risk_medium')?.value.trim() || null,
          risk_high: document.getElementById('risk_high')?.value.trim() || null,
          risk_very_high: document.getElementById('risk_very_high')?.value.trim() || null,
          quality_nuclear: document.getElementById('quality_nuclear')?.value.trim() || null,
          quality_god_tier: document.getElementById('quality_god_tier')?.value.trim() || null,
          quality_elite: document.getElementById('quality_elite')?.value.trim() || null,
          quality_premium: document.getElementById('quality_premium')?.value.trim() || null,
          quality_good: document.getElementById('quality_good')?.value.trim() || null,
          quality_deal: document.getElementById('quality_deal')?.value.trim() || null,
          dumps: document.getElementById('dumps')?.value.trim() || null,
          spikes: document.getElementById('spikes')?.value.trim() || null,
          flips: document.getElementById('flips')?.value.trim() || null
        }
      };
      
      fetch(`/config/{{ guild_id }}`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(config)
      })
      .then(async response => {
        if (response.ok) {
          statusDiv.innerHTML = '<span style="color: var(--accent-success);">‚úÖ Configuration saved successfully!</span>';
          setTimeout(() => {
            statusDiv.innerHTML = '';
          }, 3000);
        } else {
          const error = await response.json().catch(() => ({error: 'Unknown error'}));
          statusDiv.innerHTML = `<span style="color: var(--accent-danger);">‚ùå Error: ${error.error || 'Failed to save configuration'}</span>`;
        }
      })
      .catch(e => {
        console.error(e);
        statusDiv.innerHTML = `<span style="color: var(--accent-danger);">‚ùå Error: ${e.message}</span>`;
      });
    }
  </script>
</body>
</html>
