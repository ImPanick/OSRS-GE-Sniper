<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GE Sniper Config - {{ guild_id }}</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <h1>âš™ï¸ Server Configuration</h1>
  
  <nav>
    <a href="/dashboard">ğŸ“Š Dashboard</a>
    <a href="/volume_tracker">ğŸ“ˆ Volume Tracker</a>
    <a href="/admin">ğŸ”’ Admin</a>
  </nav>

  <div style="max-width: 1200px; margin: 0 auto; padding: 0 2rem;">
    <div class="card" style="margin-bottom: 1rem;">
      <h3 style="margin: 0;">Guild ID: <code style="color: var(--accent-primary); background: var(--bg-tertiary); padding: 0.25rem 0.5rem; border-radius: var(--radius-sm);">{{ guild_id }}</code></h3>
    </div>

    <div class="card">
      <h2>ğŸ“¢ Channel Routing</h2>
      <p style="color: var(--text-secondary); margin-bottom: 2rem;">Configure which Discord channels receive different types of notifications.</p>
      
      <div class="channel-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
        <div class="filter-group">
          <label>Cheap Flips (&lt; {{ (config.thresholds.cheap_max / 1000)|int }}k)</label>
          <input type="text" id="cheap_flips" placeholder="#cheap-flips" value="{{ config.channels.cheap_flips or '' }}">
        </div>
        <div class="filter-group">
          <label>Medium Flips ({{ (config.thresholds.cheap_max / 1000)|int }}k - {{ (config.thresholds.medium_max / 1000)|int }}k)</label>
          <input type="text" id="medium_flips" placeholder="#medium-flips" value="{{ config.channels.medium_flips or '' }}">
        </div>
        <div class="filter-group">
          <label>Expensive Flips ({{ (config.thresholds.medium_max / 1000)|int }}k - {{ (config.thresholds.expensive_max / 1000000)|int }}M)</label>
          <input type="text" id="expensive_flips" placeholder="#expensive-flips" value="{{ config.channels.expensive_flips or '' }}">
        </div>
        <div class="filter-group">
          <label>Billionaire Flips (&gt; {{ (config.thresholds.expensive_max / 1000000)|int }}M)</label>
          <input type="text" id="billionaire_flips" placeholder="#billionaire-flips" value="{{ config.channels.billionaire_flips or '' }}">
        </div>
        <div class="filter-group">
          <label>Recipe Items (Herbs, Secondaries, etc)</label>
          <input type="text" id="recipe_items" placeholder="#recipe-items" value="{{ config.channels.recipe_items or '' }}">
        </div>
        <div class="filter-group">
          <label>High-Alch Margins</label>
          <input type="text" id="high_alch_margins" placeholder="#high-alch" value="{{ config.channels.high_alch_margins or '' }}">
        </div>
        <div class="filter-group">
          <label>High Limit + Volume Items</label>
          <input type="text" id="high_limit_items" placeholder="#high-limit" value="{{ config.channels.high_limit_items or '' }}">
        </div>
      </div>
      
      <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
        <button onclick="save()" style="min-width: 200px;">ğŸ’¾ Save Configuration</button>
        <button onclick="location.reload()" class="secondary" style="min-width: 200px;">ğŸ”„ Reset</button>
      </div>
      
      <div id="save_status" style="margin-top: 1.5rem; min-height: 1.5rem; text-align: center;"></div>
    </div>
  </div>

  <footer>
    <p>Configuration Panel â€¢ Changes take effect immediately</p>
  </footer>

  <script>
    function save() {
      const statusDiv = document.getElementById('save_status');
      statusDiv.innerHTML = '<div class="loading" style="margin: 0 auto;"></div><p style="margin-top: 0.5rem; color: var(--text-muted);">Saving...</p>';
      
      const config = {
        channels: {
          cheap_flips: document.getElementById('cheap_flips').value.trim() || null,
          medium_flips: document.getElementById('medium_flips').value.trim() || null,
          expensive_flips: document.getElementById('expensive_flips').value.trim() || null,
          billionaire_flips: document.getElementById('billionaire_flips').value.trim() || null,
          recipe_items: document.getElementById('recipe_items').value.trim() || null,
          high_alch_margins: document.getElementById('high_alch_margins').value.trim() || null,
          high_limit_items: document.getElementById('high_limit_items').value.trim() || null
        }
      };
      
      fetch(`/config/{{ guild_id }}`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(config)
      })
      .then(async response => {
        if (response.ok) {
          statusDiv.innerHTML = '<span style="color: var(--accent-success);">âœ… Configuration saved successfully!</span>';
          setTimeout(() => {
            statusDiv.innerHTML = '';
          }, 3000);
        } else {
          const error = await response.json().catch(() => ({error: 'Unknown error'}));
          statusDiv.innerHTML = `<span style="color: var(--accent-danger);">âŒ Error: ${error.error || 'Failed to save configuration'}</span>`;
        }
      })
      .catch(e => {
        console.error(e);
        statusDiv.innerHTML = `<span style="color: var(--accent-danger);">âŒ Error: ${e.message}</span>`;
      });
    }
  </script>
</body>
</html>
